{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CS SETS</title>
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/header.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/footer.css' %}" />
    <link rel="stylesheet" href="{% static 'css/tools/quizz.css' %}" />

    <style>
      .section-title {
        font-size: 40px;
        font-weight: bold;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      {% include 'navbar.html' %} {% include 'header.html' %}

      <main>
        {% if messages %}
        <!-- SweetAlert JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
        <script>
          // Show SweetAlert success message\
          Swal.fire({
            title: "{{ message }}",
            text: "Deleted successfully.",
            icon: "success",
          });
        </script>
        {% endif %}
        <section class="content">
          <h2 class="section-title">Study Tool</h2>
          <div class="options-container">
            <button
              class="create-new"
              onclick="window.location.href='{% url 'create_quizz' %}'"
            >
              + Create new
            </button>

            <select class="sort-options" onchange="sortQuizzes(this.value)">
              <option value="last_updated">Last Updated</option>
              <option value="alphabetical">Alphabetical</option>
            </select>
          </div>
          {%if quizzes%} {%for quiz in quizzes%}
          <div class="files-section">
            <div class="file-card">
              <div class="file-info">
                <h3>{{quiz.title}}</h3>

                <span class="file-type">{{quiz.QueAns|length}} questions</span>
                <span class="studied"></span>
                <span class="timestamp">{{quiz.timestamp}}</span>
                <div class="tag">
                  {% for tag in quiz.tags %}
                  <span class="tag-label"># {{ tag }}</span>
                  {% endfor %}
                </div>
              </div>
              <div class="file-actions">
                <button
                  class="preview-btn"
                  onclick="window.location.href='{% url 'flashcard' quiz.QuizID %}'"
                >
                  Preview
                </button>
              </div>
            </div>
          </div>
          {%endfor%} {%else%}
          <p>
            No quizzes found. Go to <a href="/create_quizz">create</a> a quiz
          </p>
          {%endif%}
        </section>
      </main>

      {% include 'footer.html' %}
    </div>
    <script src="{% static 'js/backend.js' %}"></script>
    <script>
      function sortQuizzes(criteria) {
        const quizCards = document.querySelectorAll(".file-card");
        const quizArray = Array.from(quizCards);

        if (criteria === "last_updated") {
          quizArray.sort((a, b) => {
            const aTimestamp = new Date(
              a.querySelector(".timestamp").textContent
            );
            const bTimestamp = new Date(
              b.querySelector(".timestamp").textContent
            );
            return bTimestamp - aTimestamp; // Sort descending
          });
        } else if (criteria === "alphabetical") {
          quizArray.sort((a, b) => {
            const aTitle = a.querySelector("h3").textContent.toLowerCase();
            const bTitle = b.querySelector("h3").textContent.toLowerCase();
            return aTitle.localeCompare(bTitle); // Sort alphabetically
          });
        }

        const container = document.querySelector(".files-section");
        container.innerHTML = ""; // Clear existing quizzes
        quizArray.forEach((quiz) => container.appendChild(quiz)); // Append sorted quizzes
      }
    </script>
  </body>
</html>
