{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <title>{{ post.title }}</title> -->
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/header.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/footer.css' %}" />
    <link rel="stylesheet" href="{% static 'css/tools/forum.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      {% include 'navbar.html' %} {% include 'header.html' %}
      <main>
        <section class="content">
          {% if post %}
          <div class="containerViewPost">
            <h1 class="subject">{{post.subject}}</h1>
            <div class="titleViewPost">{{ post.title }}</div>

            <div class="comment-section"></div>

            <div class="black_font">{{ post.content|safe }}</div>
            <div class="label-container">
              {% for tag in post.tags %}
              <span class="tag-label"># {{ tag }}</span>
              {% endfor %}
            </div>

            <div class="post-details">
              <div class="question-details">
                <span class="black_font">Asked by:</span> {{ post.author }}
              </div>
              <div class="view_post_time">
                <span class="black_font">Post Time :</span>{{ post.timestamp }}
              </div>
              <span class="add-comment" id="addCommentBtn">Add A Comment</span>
            </div>

            <!-- add modal rich text(add comment) -->
            <!-- <div id="commentModal" class="modal">
              <div id="modal-content">
                  <h2>Add a Comment</h2>
                  <div id="editor"></div>
                  <button type="submit" id="submitComment">Reply</button>
                  <button id="cancel">Cancel</button>
              </div>
            </div> -->

            <form method="POST" action="{% url 'submit_comment' post.PostID %}">
              {% csrf_token %}
              <div id="commentModal" class="modal">
                <div id="modal-content">
                  <h2>Add a Comment</h2>
                  <div id="editor"></div>
                  <input type="hidden" id="content" name="content" />
                  <button type="submit" id="submitComment">Reply</button>
                  <button type="button" id="cancel">Cancel</button>
                </div>
              </div>
            </form>
            <div class="comment-section">
              <span class="reply">Reply</span>
              <div class="comment">
                <div class="comment-text">The answer is A.</div>
                <div class="comment-author">Mansurul Haque</div>
              </div>
            </div>
          </div>

          {% else %}
          <p>{{ error }}</p>
          {% endif %}
        </section>
      </main>

      {% include 'footer.html' %}
      <script src="{% static 'js/backend.js' %}"></script>
      <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const addCommentBtn = document.getElementById("addCommentBtn");
          const commentModal = document.getElementById("commentModal");
          const closeModal = document.getElementById("cancel");
          const submitComment = document.getElementById("submitComment");
          const authorEmail = sessionStorage.getItem("userEmail");

          const toolbarOptions = [
            [{ header: [1, 2, 3, 4, 5, 6, false] }],
            [{ font: [] }],
            ["bold", "italic", "underline", "strike"], // toggled buttons
            ["blockquote", "code-block"],
            ["link", "image", "video", "formula"],
            [{ header: 1 }, { header: 2 }], // custom button values
            [{ list: "ordered" }, { list: "bullet" }, { list: "check" }],
            [{ indent: "-1" }, { indent: "+1" }], // outdent/indent
            [{ direction: "rtl" }], // text direction
            [{ color: [] }, { background: [] }], // dropdown with defaults from theme
            [{ align: [] }],
            ["clean"], // remove formatting button
          ];

          // Initialize Quill editor
          const quill = new Quill("#editor", {
            modules: {
              toolbar: toolbarOptions,
            },
            theme: "snow",
          });

          // Show modal when "Add A Comment" is clicked
          addCommentBtn.onclick = function () {
            commentModal.style.display = "block";
          };

          // Close modal when the close button is clicked
          cancel.onclick = function () {
            commentModal.style.display = "none";
          };
        });
      </script>
    </div>
  </body>
</html>
