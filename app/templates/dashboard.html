{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS SETS</title>
    <link rel="stylesheet" href="/static/css/navbar.css">  
    <link rel="stylesheet" href="/static/css/header.css">  
    <link rel="stylesheet" href="/static/css/style.css">  
    <link rel="stylesheet" href="/static/css/footer.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet" />
</head>

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        overflow-y: auto;
        padding: 20px;
    }

    .modal.show {
        opacity: 1;
        display: block;
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5vh 30%;
        padding: 20px;
        border: 1px solid #888;
        width: 90%;
        max-width: 800px;
        border-radius: 5px;
        transform: translateY(-50px);
        opacity: 0;
        transition: all 0.3s ease-in-out;
        position: relative;
    }

    .modal.show .modal-content {
        transform: translateY(0);
        opacity: 1;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover {
        color: black;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .form-group #editor {
        height: 300px;
        margin-bottom: 20px;
    }

    .submit-btn {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .submit-btn:hover {
        background-color: #45a049;
    }

    /* Quill editor container */
    .ql-container {
        font-size: 16px;
    }

    /* Ensure toolbar is visible */
    .ql-toolbar {
        background: white;
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    /* Tooltip styles */
    [data-tooltip] {
        position: relative;
    }

    [data-tooltip]:before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 5px 10px;
        background-color: #333;
        color: white;
        border-radius: 4px;
        font-size: 12px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.2s ease;
        transition-delay: 500ms;
        z-index: 1000;
    }

    [data-tooltip]:hover:before {
        opacity: 1;
        visibility: visible;
    }

    .fade-message {
        animation: fadeOut 5s ease-in-out forwards;
    }

    @keyframes fadeOut {
        0% { opacity: 1; }
        70% { opacity: 1; }
        100% { opacity: 0; }
    }

    .alert-success {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 0.25rem;
    }

    .fade-message {
        position: fixed;
        top: 20px;
        left: 55%;
        transform: translateX(-50%);
        z-index: 1000;
        min-width: 300px;
        text-align: center;
        opacity: 1;
        transition: opacity 0.5s ease-in-out;
    }

    .fade-out {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease-in-out;
    }
</style>

<body>
    <div class="container">
        {% include 'navbar.html' %} 

        {% include 'header.html' %} 

        <main style="padding-top: 0%;">
            <button class="btn btn-add-announce">
                Create Announcement
            </button>

            <div id="addannounce" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Create New Announcement</h2>
                    <form method="POST" action="{% url 'dashboard' %}">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="title">Title:</label>
                            <input type="text" id="add-title" name="add-title" required>
                        </div>
                        <div class="form-group">
                            <label for="content">Content:</label>
                            <div id="editor"></div>
                            <input type="hidden" id="add-content" name="add-content" />
                        </div>
                        <button type="submit" class="submit-btn">Post Announcement</button>
                        <p style="display: none;"></p>
                    </form>
                </div>
            </div>
            
            <div class="main-content">
                <div class="announcement-card">
                    <div class="announcement-content">
                        <div class="announcement-header">
                            <div class="profile-container">
                                <img src="/static/image/user.png" alt="Profile Picture" class="profile-img">
                                <p>Mr. Bean</p>
                            </div>
                            <div class="announcement-details">
                                <h3>Changes venue for event application</h3>
                                <p class="announcement-body">
                                    Dear student, today due to emergency reason, hall B are closed until 14/11/2025, thus student need to register your application at hall A...
                                    <span class="expand-text">[expand]</span>
                                </p>
                                <p class="posted-info">posted 11.00PM 11 Aug 2024</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        {% include 'footer.html' %} 
    </div>

    <script src="{% static 'js/backend.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <script>
        // Quill toolbar configuration with tooltips
        const toolbarOptions = [
            // Essential formatting options
            [
                'bold',
                'italic',
                'underline',
                'strike'
            ],
            
            // Headers and text style
            [{ 'header': [1, 2, 3, false] }],
            
            // Lists
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            
            // Indentation
            [{ 'indent': '-1'}, { 'indent': '+1' }],
            
            // Text alignment
            [{ 'align': [] }],
            
            // Links and media
            ['link', 'image'],
            
            // Color options
            [{ 'color': [] }, { 'background': [] }],
            
            // Clean formatting
            ['clean']
        ];

        // Initialize Quill
        const quill = new Quill('#editor', {
            modules: {
                toolbar: toolbarOptions
            },
            theme: 'snow'
        });

        // Add tooltips after Quill is initialized
        const tooltips = {
            'bold': 'Bold (Ctrl+B)',
            'italic': 'Italic (Ctrl+I)',
            'underline': 'Underline (Ctrl+U)',
            'strike': 'Strikethrough',
            'header': 'Heading',
            'list': 'List',
            'indent-1': 'Indent Left',
            'indent+1': 'Indent Right',
            'align': 'Align',
            'link': 'Insert Link',
            'image': 'Insert Image',
            'color': 'Text Color',
            'background': 'Background Color',
            'clean': 'Clear Formatting'
        };

        // Apply tooltips to toolbar buttons
        setTimeout(() => {
            const buttons = document.querySelectorAll('.ql-toolbar button, .ql-toolbar select');
            buttons.forEach(button => {
                const className = Array.from(button.classList)
                    .find(cls => cls.startsWith('ql-'));
                if (className) {
                    const format = className.replace('ql-', '');
                    // Special handling for indent buttons
                    if (format === 'indent') {
                        const value = button.value;
                        if (value === '-1') {
                            button.setAttribute('data-tooltip', 'Indent Left');
                        } else if (value === '+1') {
                            button.setAttribute('data-tooltip', 'Indent Right');
                        }
                    } else if (tooltips[format]) {
                        button.setAttribute('data-tooltip', tooltips[format]);
                    }
                }
            });
        }, 100);

        // Modal and form handling
        const modal = document.getElementById('addannounce');
        
        document.querySelector('.btn-add-announce').onclick = function() {
            modal.style.display = 'block';
            setTimeout(() => {
                modal.classList.add('show');
                quill.focus();
            }, 10);
        }

        document.querySelector('.close').onclick = function() {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }

        // Form submission
        document.querySelector('form').addEventListener('submit', function(event) {
            event.preventDefault();
            const content = quill.root.innerHTML;
            document.getElementById('add-content').value = content;
            this.submit();
        });

        document.addEventListener('DOMContentLoaded', function() {
            const welcomeAlert = document.getElementById('welcomeAlert');
            if (welcomeAlert) {
                // Wait 3 seconds before starting fade out
                setTimeout(() => {
                    welcomeAlert.classList.add('fade-out');
                    // Remove from DOM after fade completes
                    setTimeout(() => {
                        welcomeAlert.remove();
                    }, 500);
                }, 3000);
            }
        });
    </script>

    {% if welcome_message %}
    <div class="alert alert-success fade-message" id="welcomeAlert">
        {{ welcome_message }}
    </div>
    {% endif %}
</body>
</html>